workflow_meta:
  title: "Indeed (Puppeteer) Basic Search"
  description: "Search on indeed.com with session management and humanization (Puppeteer)"
  start_step: "init_context"

steps_config:
  init_context:
    step: 0
    func: "step0"
    transitions:
      ctx_ready: "open_homepage"
    timeout: 30
    on_timeout_event: "ctx_ready"

  open_homepage:
    step: 1
    func: "openHomepage"
    transitions:
      homepage_opened: "wait_for_load"
      page_navigation_failed: "refresh_page"
    timeout: 30
    on_timeout_event: "page_navigation_failed"

  wait_for_load:
    step: 2
    func: "waitForPageLoad"
    transitions:
      page_loaded: "detect_page_state"
      page_load_retry: "refresh_page"
    timeout: 20
    on_timeout_event: "page_load_retry"

  refresh_page:
    step: 2.5
    func: "refreshPage"
    transitions:
      page_refreshed: "wait_for_load"
      no_page_to_refresh: "open_homepage"
      page_reload_failed: "open_homepage"
    timeout: 30
    on_timeout_event: "page_reload_failed"

  detect_page_state:
    step: 3
    func: "detectPageState"
    transitions:
      logged_in: "perform_search"
      sign_in_required: "show_sign_in_banner"
      no_cards_found: "perform_search"
    timeout: 20
    on_timeout_event: "perform_search"

  show_sign_in_banner:
    step: 4
    func: "showSignInBanner"
    transitions:
      signin_banner_shown: "perform_search"
      signin_banner_retry: "refresh_page"
    timeout: 300
    on_timeout_event: "signin_banner_retry"

  perform_search:
    step: 5
    func: "performBasicSearch"
    transitions:
      search_completed: "collect_job_cards"
      search_failed: "refresh_page"
    timeout: 60
    on_timeout_event: "search_failed"

  collect_job_cards:
    step: 6
    func: "collectJobCards"
    transitions:
      cards_collected: "click_job_card"
      cards_collect_retry: "collect_job_cards"
    timeout: 30
    on_timeout_event: "cards_collect_retry"

  click_job_card:
    step: 7
    func: "clickJobCard"
    transitions:
      job_card_clicked: "detect_apply_type"
      job_card_skipped: "click_job_card"
      job_cards_finished: "click_next_page"
    timeout: 10
    on_timeout_event: "job_card_skipped"

  click_next_page:
    step: 7.5
    func: "clickNextPage"
    transitions:
      next_page_clicked: "collect_job_cards"
      no_more_pages: "done"
    timeout: 15
    on_timeout_event: "no_more_pages"

  detect_apply_type:
    step: 8
    func: "detectApplyType"
    transitions:
      easy_apply_found: "parseJobDetails"
      regular_apply_found: "skipToNextCard"
      no_apply_found: "skipToNextCard"
      detect_apply_failed: "skipToNextCard"
    timeout: 10
    on_timeout_event: "skipToNextCard"

  parseJobDetails:
    step: 9
    func: "parseJobDetails"
    transitions:
      job_parsed: "clickEasyApply"
      parse_failed: "skipToNextCard"
    timeout: 15
    on_timeout_event: "parse_failed"

  clickEasyApply:
    step: 9.5
    func: "clickEasyApply"
    transitions:
      easy_apply_clicked: "waitForEasyApplyPage"
      easy_apply_failed: "click_job_card"
    timeout: 10
    on_timeout_event: "easy_apply_failed"

  waitForEasyApplyPage:
    step: 10
    func: "waitForEasyApplyPage"
    transitions:
      easy_apply_page_ready: "handleEasyApplyForm"
      page_load_timeout: "closeEasyApplyAndContinueSearch"
    timeout: 15
    on_timeout_event: "page_load_timeout"

  handleEasyApplyForm:
    step: 11
    func: "handleEasyApplyForm"
    transitions:
      form_completed: "submitApplication"
      form_error: "closeEasyApplyAndContinueSearch"
    timeout: 60
    on_timeout_event: "form_error"

  submitApplication:
    step: 12
    func: "submitApplication"
    transitions:
      application_submitted: "closeEasyApplyAndContinueSearch"
      submission_failed: "closeEasyApplyAndContinueSearch"
    timeout: 30
    on_timeout_event: "submission_failed"

  closeEasyApplyAndContinueSearch:
    step: 13
    func: "closeEasyApplyAndContinueSearch"
    transitions:
      hunting_next_job: "click_job_card"
      close_and_continue_error: "click_job_card"
    timeout: 10
    on_timeout_event: "close_and_continue_error"

  skipToNextCard:
    step: 14
    func: "skipToNextCard"
    transitions:
      card_skipped: "click_job_card"
    timeout: 5
    on_timeout_event: "card_skipped"

